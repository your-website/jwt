# Задача 
**Разграничение доступа с использованием JWT**

Реализован процесс аутентификации с помощью JWT, создание пользователя и изменение пароля. При изменении пароля он не может совпадать с 5 предыдущими паролями пользователя.

## Решение
1.Что использовано?
Для реализации задачи использовался сервис Яндекс.Облако.
На данном сервисе создана виртуальная машина с образом Ubuntu 18.04 lts.
Установлены NodeJS, MongoDB, Git.
При подключения к виртуальной машине использован ssh-ключ.
Для запуска сервера при перезагрузке использован pm2 как глобальный модуль.
Подключен порт nginx.
Выпущен SSL-сертификат от Letsencrypt с помощью certbot.

Чтобы реализовать поставленную задачу использован фреймворк Express.js с использованием базы данных MongoDB.
Настроены routes, controllers, middlewares, model.

2.Как работает?
Чтобы развернуть проект у себя, необходимо клонировать репозиторий, в командной строке прописать npm i, дождаться установки, запустить MongoDB, прописав в командной строке mongod, после чего запустить приложение командой npm run dev.

	Для тестирования сервера можно использовать Postman или любое другое приложение для отправки на сервер запросов и получения ответов. Если проект развернут локально, то запрос отправлять по адресу http://localhost:3000/
	Либо https://jwt-api.tk/
 
При регистрации пользователя необходимо по адресу http://localhost:3000/signup или https://jwt-api.tk/signup в тело запроса передать:

`
{
    "name": " name ",
    "email": " name@name.ru",
    "password": " namename "
}
`

Данные поля записываются в базу данных для дальнейшей работы. 

При этом пароль захеширован с помощью модуля bcryptjs.

Если имя пользователя либо email уже существуют, то программа укажет это и попросит ввести другие названия.

При этом хеш пароля также записывается в массив prevPassword.

После успешной регистрации необходимо войти. Для этого по адресу http://localhost:3000/signin или https://jwt-api.tk/signin в тело запроса передать:

`
{
    "name": " name ",
    "password": " namename "
}
`

Если пользователь существует, то программа сравнивает захешированный пароль с хешем в базе. Для этого использован метод bcrypt.compare.

Если пароль верный, то будет отправлен токен, который можно использовать для получения информации о пользователе. Для этого по адресу http://localhost:3000/users/me или https://jwt-api.tk/users/me в заголовок Authorization необходимо передать полученный ранее токен.

Чтобы изменить пароль - нужно по адресу http://localhost:3000/ changepassword или https://jwt-api.tk/changepassword в тело запроса передать:

`
{
    "name": " name",
    "password": "старый пароль",
    "newpassword": "новый пароль"
}
`

	При этом новый пароль не должен совпадать с предыдущими пятью паролями пользователя. Каждый новый пароль записывается в массив prevPassword. Если хеш нового пароля совпадает с хешем предыдущих 5, то пользователь получит уведомление о том, что данный пароль им был ранее введен и попросит придумать другой пароль. Если в массиве prevPassword больше пяти паролей, то первый удаляется.

3.Время на работу
 
Написание кода заняло около 8 часов (запутался в промисах… ).

Развернуть виртуальную машину около 2ух часов.

Написание readme 30-60 минут.
